---
interface Item {
  original: string;
  thumbnail: string;
  width: number;
  height: number;
  caption?: string;
  alt?: string;
}

const { title = "Galer√≠a", id = "pswp-gallery", items = [] } = Astro.props;
---

<section class="gallery-section">
  {title && <h2>{title}</h2>}

  <div id={id} class="thumbnail-grid pswp-gallery">
    {
      items.map((it, i) => (
        <a
          href={it.original}
          data-pswp-width={it.width}
          data-pswp-height={it.height}
          data-pswp-caption={it.caption ?? ""}
          aria-label={it.alt ?? it.caption ?? `Foto ${i + 1}`}
        >
          <img
            src={it.thumbnail}
            alt={it.alt ?? it.caption ?? `Foto ${i + 1}`}
            loading="lazy"
            decoding="async"
            class="thumbnail"
            srcset={`${it.thumbnail} 800w, ${it.original} 1098w`}
            sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw"
          />
        </a>
      ))
    }
  </div>
</section>

<!-- Inicializa PhotoSwipe (CDN) -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.css"
/>
<script type="module" define:vars={{ id }}>
  import PhotoSwipeLightbox from "https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js";
  import PhotoSwipe from "https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.esm.min.js";

  const lb = new PhotoSwipeLightbox({
    gallery: "#" + id,
    children: "a",
    pswpModule: () => PhotoSwipe,
    showHideAnimationType: "zoom",
    wheelToZoom: true,
    preload: [1, 2],
    secondaryZoomLevel: 1.5,
  });
  lb.init();
</script>

<style>
  .thumbnail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 12px;
  }
  .thumbnail {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
  }
</style>
